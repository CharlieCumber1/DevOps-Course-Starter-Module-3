script:
- docker build --target test --tag todo-app:test .
- docker run todo-app:test tests
- docker run -e TRELLO_API_KEY -e TRELLO_API_SECRET todo-app:test e2e_tests

after_success:
  - docker build --target production --tag todo-app .
  - docker image tag todo-app "${DOCKER_USERNAME}/todo-app:latest"
  - docker image tag todo-app "${DOCKER_USERNAME}/todo-app:${TRAVIS_COMMIT}"
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - echo /home/travis/.docker/config.json
  - docker push --all-tags "${DOCKER_USERNAME}/todo-app"
env:
  global:
  - DOCKER_USERNAME=charliecumber
  - secure: P1pNCZQQF1Ar3vFeko1/e4nYboTs3gAWkkAH1i1eXxsnYeK7gtzOVSjzSipt716hleF4GkYv1hOTHn2nkO2nWF+chBItr2nlbZIkv/0q1kSrFoAYhb8WbwXb93HY5j6tbPclo1+a2oxKBPwMk+etxh+54dDsh5puTXJCJds8rabhTZ9e+AcbftYAyTTxME599xhqzrpVf/nnDUTmqjv7VuFbznhw4yjtHqWoNgW0xox6IeFp3h8OGPkLPw0THzQHpgeYXmEHxAzCD6pT7cY2Nb+xB5JYc2JMc+/cJg2vUjCggagfttG1QVKgfFYJVBxu4ZF62AKuWePWNM+ojLuERnSmRUG8cnQuwk3X/FpWFqjQAnP+k/su4woO9Ke9aV+TsU1jpnDt4MHqWdhE+ntCBrb5CGtuk90o0udDKPOLBRbcu9EZ7RSJlR5NslAW/69tM7azW/wgA1z80Gy7AlhljC5YNxjDQcWgS5+OgNjLKy/xndHuvk+4puDKOc+5KpBUcKpaS9hJaSTOK3LbSv+cbSqiTd5zSUK3KNlU1+U3I9GD6CmCd2vxqtrh2WD82+leNI8phJfJrCqPssJIiFzMT+UlHYWLMo+uYDC1IY9ZVAaDN0w5uQ4JDnepoCq0sg0423EiJjoaRZvjNkZQz1KG9LDNqSqmYYFL1abU2X14/Y4=
  - secure: W02uXD0t7lsj8qTFS2PVGdDmQ9aGdh/5Zy066GrnVzOKTpZ6j4lOUrev1Rf/kh1pFXCbT+tPWVD4MLQdwukMYFHlltVK5WIMK1m5MD/wjljHyCoMwB+BMvP6HnKZ7t61PsJnUL6zx6wHC0FIiaj2+hSw3b/05fNRokyvayyTHYsBpTazNfavf5J1Y9beV8Jh19AT6wwwmSy88pxO6GLNK8JIwHrJwfLNZ3yOgh42kesTJdmB4CXdyrhowgO2T/AYhTdfDIBYnrGGQbo5t8nUpl9LtQX2c18mZ8rXinrZddAX8zeV4W7uQKgSHUfDD1CuYQZItrR3jrzlop56YRti9J6wIfxpQBrl+Mp2lTJzjsmgsDifnaTvMVCXKLTYZEpKr5K3/Ov8VFnOxV+m2LCLuxgLi7n3l+aQeeBCIZpQ9RmNShDhz+zEfS4JA3gZHFTxsHkN4ICzPvslCosomMqt7JFCrzhwisFeYERXWZaT2Em4cMvSOj18mPtk8sqEbnq9VBzs5LKMje0eATz1BKHc1uMyO2mUMJXPsucl3gDyRGV289Z4AgiScZ1utVYUChK4ngC4b35hwW/fKmf2lP67e+0I4ippKd0j3cwSxukfFAPv3C0ZkuJcqO+DuXATYYFXbLFiVwbi9pkVRmoaQ9Ka5WGNUg69OyHZRY+DY3JdURk=
  - secure: vXObwB6o3BOI97C+Ybeh18sl4TfuhIF9p063seDye69RmU1yGt8FH93IPI2rHlue/WkuuqOBFsBnn6rKopwEiS80yRs5ElB6Z2BDIT7gDTstZABaYzeM36ax0QWC0u/+nRN7Y88pnhLE6ULZVnN4/eKL+JWOIhvtRmuu7kBvBNUDEi3E1LsVvzjFL8hSTpkz8VsJjhkyifpffO0zq3gvYKxULkdx5yZSZ8BwS1Qgmng4/zJcVVc5IEZ5FITK8A98xLD0VFtlAjhUJF23PywnkhlTIsL+9pmgSyEAJA+gACgJpUKUy8JgB8xnPDeqP8pHd3/ejYTfjrALw/MNxaBjL89KDMMf/4Xr+2U9N2lZH50MRli8uj8s3942fl8w9FMv44PZSu32JXkHYhs0TF6Nektwn74Rbfc0zsJXov+hUBSF9tge86gNnqxU+QrgoxpuYtraymknEZW3dZJcGUftAS732EzkMPX+PjGJAm77NIotNKnNxTiEvX24kssTXrOng18o0yeGYpTYDD23qzEuiDerTklJbIS2U1AwC1uowfDZ7JVHlN+ZChOudiDDDk8sYuiI6lACc8KaFEdQGTFsN5lbGhGNK7dgZVhh2r1hYIpfVnIGbk2jCTLScDGUTBiCLw7LTRionVhjqPEOL7SW8CSBNXkYFBA13S1dILUGOgo=